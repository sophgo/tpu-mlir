Environment Setup
=================

First check whether the current system environment meets ubuntu 22.04 and python 3.10. 
If not, please proceed to the next section *Basic Environment Configuration*; 
if satisfied, jump directly to *Install tpu_mlir*.

Basic Environment Configuration
---------------------------------
Download the required image from DockerHub https://hub.docker.com/r/sophgo/tpuc_dev :


.. code-block:: shell

   $ docker pull sophgo/tpuc_dev:v3.1


If you are using docker for the first time, you can execute the following commands to install and configure it (only for the first time):


.. _docker configuration:

.. code-block:: shell
   :linenos:

   $ sudo apt install docker.io
   $ sudo systemctl start docker
   $ sudo systemctl enable docker
   $ sudo groupadd docker
   $ sudo usermod -aG docker $USER
   $ newgrp docker

.. _docker container_setup:

Make sure the installation package is in the current directory, and then create a container in the current directory as follows:


.. code-block:: shell

  $ docker run --privileged --name myname -v $PWD:/workspace -it sophgo/tpuc_dev:v3.1
  # "myname" is just an example, you can use any name you want

Subsequent chapters assume that the user is already in the /workspace directory inside docker.


Install tpu_mlir
----------------------
Install tpu_mlir with pip [#whl_install]_

.. code-block:: shell

   $ pip install tpu_mlir

tpu_mlir requires different dependencies when processing models of different frameworks. 
For model files generated by *onnx* or *torch*, use the following command to install additional dependency environments:

.. code-block:: shell

   $ pip install tpu_mlir[onnx]

.. code-block:: shell

   $ pip install tpu_mlir[torch]

There are 5 config currently supported:
*onnx*, *torch*, *tensorflow*, *caffe*, *paddle*.
Or you can use *all* to install all dependencies:

.. code-block:: shell

   $ pip install tpu_mlir[all]


.. [#whl_install] when tpu_mlir-{version}.whl file is available locally, you can also install tpu_mlir by running:
   
   .. code :: console

      $ pip install path/to/tpu_mlir-{version}.whl[all]