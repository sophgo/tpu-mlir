RUN: bmodel_dis.py %p/bmodel/yolov5s_bm1688_int8_sym_core2.bmodel | FileCheck %s

CHECK:  module attributes {chip = "BM1688", version = 2.2} {
CHECK:      ^bb-1(%G0: memref<1x3x640x640xui8, strides: [1228800, 409600, 640, 1]>)    //  run_mode=TPU_STATIC
CHECK-NEXT:        %B1C0 = "system.send_msg"(%D0C0) {msg_id = 30, cnt = 4}
CHECK-NEXT:        %B1C1 = "system.send_msg"(%D0C1) {msg_id = 30, cnt = 4}
CHECK-NEXT:        %D1C0 = "dma.sys.sys_send"(%B1C0) {msg_id = 30, cnt = 4}
CHECK-NEXT:        %D1C1 = "dma.sys.sys_send"(%B1C1) {msg_id = 30, cnt = 4}
CHECK-NEXT:        %B2C0 = "system.wait_msg"(%D1C0) {msg_id = 30, cnt = 4}
CHECK:        %B19C0 = "system_tr_wr.wr_imm"(%D14C0) {reg_idx0 = 5, reg_idx1 = 6, reg_idx2 = 127, des_imm0 = 0, des_imm1_h32 = 0, des_imm1_l32 = 122880}
CHECK-NEXT:        %B19C1 = "system_tr_wr.wr_imm"(%D14C1) {reg_idx0 = 5, reg_idx1 = 6, reg_idx2 = 127, des_imm0 = 0, des_imm1_h32 = 0, des_imm1_l32 = 122880}
CHECK-NEXT:        %R11, %B20C0 = "conv.normal"(%R0, %R15.16, %R15.8, %C0, %R0, %D14C0) {kernel = [6, 6], stride = [2, 2], in_zero = [0, 0], ke_zero = [0, 0], opt_kernel_rotate = False, pad_mode = 0, pad = [0, 0, 2, 2], opt_res_add = False, do_relu = False, sym_range = False, do_rq = True, round_mode = 5, kzp = 0}: (memref<1x3x134x640xui8, strides: [85760, 85760, 640, 1]>, memref<32x3x6x6xsi8>, memref<1x32x1x1xsi32, strides: [1, 1, 1, 1]>, ui8, memref<1x32x1x2xsi32, strides: [2, 2, 2, 1]>, none) -> (memref<1x32x65x320xsi8, strides: [20800, 20800, 320, 1]>, none)
CHECK-NEXT:        %R11, %B20C1 = "conv.normal"(%R0, %R15.16, %R15.8, %C0, %R0, %D14C1) {kernel = [6, 6], stride = [2, 2], in_zero = [0, 0], ke_zero = [0, 0], opt_kernel_rotate = False, pad_mode = 0, pad = [0, 2, 2, 2], opt_res_add = False, do_relu = False, sym_range = False, do_rq = True, round_mode = 5, kzp = 0}: (memref<1x3x132x640xui8, strides: [84480, 84480, 640, 1]>, memref<32x3x6x6xsi8>, memref<1x32x1x1xsi32, strides: [1, 1, 1, 1]>, ui8, memref<1x32x1x2xsi32, strides: [2, 2, 2, 1]>, none) -> (memref<1x32x65x320xsi8, strides: [20800, 20800, 320, 1]>, none)
CHECK-NEXT:        %G3686400, %D15C0 = "dma.tensor"(%R14, %B18C0) : (memref<1x32x32x160xi8, strides: [5120, 5120, 160, 1]>, none) -> (memref<1x32x32x160xi8, strides: [819200, 25600, 160, 1]>, none)
CHECK-NEXT:        %G3701760, %D15C1 = "dma.tensor"(%R14, %B18C1) : (memref<1x32x32x160xi8, strides: [5120, 5120, 160, 1]>, none) -> (memref<1x32x32x160xi8, strides: [819200, 25600, 160, 1]>, none)
CHECK:        %R15.4768, %D25C1 = "dma.tensor"(%G98304, %B38C1) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK-NEXT:        %B47C0 = "system_tr_wr.wr_imm"(%D19C0) {reg_idx0 = 5, reg_idx1 = 6, reg_idx2 = 127, des_imm0 = 0, des_imm1_h32 = 0, des_imm1_l32 = 124560}
CHECK-NEXT:        %R0, %D26C1 = "dma.tensor"(%G1241440, %B38C1) : (memref<1x64x81x160xi8, strides: [1638400, 25600, 160, 1]>, none) -> (memref<1x64x81x160xi8, strides: [25920, 12960, 160, 1]>, none)
CHECK-NEXT:        %R11.768, %B48C0 = "conv.normal"(%R12, %R15.1696, %R15.1688, %C0, %R0, %D19C0) {kernel = [1, 1], stride = [1, 1], in_zero = [0, 0], ke_zero = [0, 0], opt_kernel_rotate = False, pad_mode = 0, pad = [0, 0, 0, 0], opt_res_add = False, do_relu = False, sym_range = False, do_rq = True, round_mode = 5, kzp = 0}: (memref<1x32x32x160xsi8, strides: [5120, 5120, 160, 1]>, memref<32x32x1x1xsi8>, memref<1x32x1x1xsi32, strides: [1, 1, 1, 1]>, si8, memref<1x32x1x2xsi32, strides: [2, 2, 2, 1]>, none) -> (memref<1x32x32x160xsi8, strides: [5120, 5120, 160, 1]>, none)
CHECK-NEXT:        %R15.4768, %B41C1 = "tsbc.l_bc"(%R15.4768, %D26C1) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x32x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK-NEXT:        %G1239040, %D20C0 = "dma.tensor"(%R13, %B44C0) : (memref<1x64x32x160xi8, strides: [10240, 5120, 160, 1]>, none) -> (memref<1x64x32x160xi8, strides: [1638400, 25600, 160, 1]>, none)
CHECK:        %R6, %B65C0 = "sg.pe_s_gather_d1coor"(%R13.5632, %R13.5632, %D33C0) {limit_enable = False, fill_const = False, const_value = 0}: (memref<1x32x1x256xi8, strides: [0, 0, 271.0, 1]>, memref<1x32x1x12800xui8, strides: [12800, 12800, 12800, 1]>, none) -> (memref<1x32x1x12800xi8, strides: [12800, 12800, 12800, 1]>, none)
CHECK-NEXT:        %B62C1 = "system.send_msg"(%D36C1) {msg_id = 31, cnt = 4}
CHECK-NEXT:        %R0, %B66C0 = "arith.copy"(%R14, %D33C0) {round_mode = 0}: (memref<1x32x80x160xsi8, strides: [12800, 12800, 160, 1]>, none) -> (memref<1x32x80x160xsi8, strides: [25600, 12800, 160, 1]>, none)
CHECK-NEXT:        %D37C1 = "dma.sys.sys_send"(%B62C1) {msg_id = 31, cnt = 4}
CHECK-NEXT:        %R1.4608, %B67C0 = "arith.copy"(%R6, %D33C0) {round_mode = 0}: (memref<1x32x80x160xsi8, strides: [12800, 12800, 160, 1]>, none) -> (memref<1x32x80x160xsi8, strides: [25600, 12800, 160, 1]>, none)
CHECK-NEXT:        %B63C1 = "system.wait_msg"(%D37C1) {msg_id = 31, cnt = 4}
CHECK:        %R4, %B105C0 = "conv.normal"(%R0, %R11.2080, %R11.2064, %C0, %R0, %D54C0) {kernel = [1, 1], stride = [1, 1], in_zero = [0, 0], ke_zero = [0, 0], opt_kernel_rotate = False, pad_mode = 0, pad = [0, 0, 0, 0], opt_res_add = False, do_relu = False, sym_range = False, do_rq = True, round_mode = 5, kzp = 0}: (memref<1x128x80x80xsi8, strides: [25600, 6400, 80, 1]>, memref<64x128x1x1xsi8>, memref<1x64x1x1xsi32, strides: [2, 1, 1, 1]>, si8, memref<1x64x1x2xsi32, strides: [4, 2, 2, 1]>, none) -> (memref<1x64x80x80xsi8, strides: [12800, 6400, 80, 1]>, none)
CHECK-NEXT:        %R8, %D55C0 = "dma.tensor"(%G348160, %B103C0) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK-NEXT:        %R8, %B106C0 = "tsbc.l_bc"(%R8, %D55C0) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x32x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK-NEXT:        %R6, %B107C0 = "sg.pe_s_gather_d1coor"(%R8, %R8, %D55C0) {limit_enable = False, fill_const = False, const_value = 0}: (memref<1x64x1x256xi8, strides: [0, 0, 271.0, 1]>, memref<1x64x1x6400xui8, strides: [12800, 6400, 6400, 1]>, none) -> (memref<1x64x1x6400xi8, strides: [12800, 6400, 6400, 1]>, none)
CHECK-NEXT:        %R0, %B108C0 = "arith.copy"(%R14, %D55C0) {round_mode = 0}: (memref<1x64x80x80xsi8, strides: [12800, 6400, 80, 1]>, none) -> (memref<1x64x80x80xsi8, strides: [25600, 6400, 80, 1]>, none)
CHECK-NEXT:        %R1.4608, %B109C0 = "arith.copy"(%R6, %D55C0) {round_mode = 0}: (memref<1x64x80x80xsi8, strides: [12800, 6400, 80, 1]>, none) -> (memref<1x64x80x80xsi8, strides: [25600, 6400, 80, 1]>, none)
CHECK:        %R2.2816, %B147C0 = "sg.pe_s_gather_d1coor"(%R5, %R5, %D78C0) {limit_enable = False, fill_const = False, const_value = 0}: (memref<1x128x1x256xi8, strides: [0, 0, 271.0, 1]>, memref<1x128x1x1600xui8, strides: [6400, 1600, 1600, 1]>, none) -> (memref<1x128x1x1600xi8, strides: [6400, 1600, 1600, 1]>, none)
CHECK-NEXT:        %R10, %D79C0 = "dma.tensor"(%G1105920, %B145C0) : (memref<1x32x1x4656xi8, strides: [148992, 4656, 4656, 1]>, none) -> (memref<1x32x1x4656xi8, strides: [4656, 4656, 4656, 1]>, none)
CHECK-NEXT:        %B148C0 = "system_tr_wr.wr_imm"(%D79C0) {reg_idx0 = 5, reg_idx1 = 6, reg_idx2 = 127, des_imm0 = 0, des_imm1_h32 = 0, des_imm1_l32 = 81920}
CHECK-NEXT:        %R4, %B149C0 = "conv.normal"(%R2.2816, %R10.48, %R10.32, %C0, %R0, %D79C0) {kernel = [3, 3], stride = [1, 1], in_zero = [0, 0], ke_zero = [0, 0], opt_kernel_rotate = False, pad_mode = 0, pad = [1, 1, 1, 1], opt_res_add = False, do_relu = False, sym_range = False, do_rq = True, round_mode = 5, kzp = 0}: (memref<1x128x40x40xsi8, strides: [6400, 1600, 40, 1]>, memref<128x128x3x3xsi8>, memref<1x128x1x1xsi32, strides: [4, 1, 1, 1]>, si8, memref<1x128x1x2xsi32, strides: [8, 2, 2, 1]>, none) -> (memref<1x128x40x40xsi8, strides: [6400, 1600, 40, 1]>, none)
CHECK-NEXT:        %R11, %D80C0 = "dma.tensor"(%G1257472, %B147C0) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK-NEXT:        %R5, %D81C0 = "dma.tensor"(%G1376256, %B147C0) : (memref<1x32x1x37056xi8, strides: [1185792, 37056, 37056, 1]>, none) -> (memref<1x32x1x37056xi8, strides: [37056, 37056, 37056, 1]>, none)
CHECK:        %R3.4800, %B193C0 = "sg.pe_s_gather_d1coor"(%R8, %R8, %D97C0) {limit_enable = False, fill_const = False, const_value = 0}: (memref<1x512x1x256xi8, strides: [0, 0, 271.0, 1]>, memref<1x512x1x400xui8, strides: [6400, 400, 400, 1]>, none) -> (memref<1x512x1x400xi8, strides: [6400, 400, 400, 1]>, none)
CHECK-NEXT:        %R5, %D98C0 = "dma.tensor"(%G3792896, %B191C0) : (memref<1x32x1x4192xi8, strides: [134144, 4192, 4192, 1]>, none) -> (memref<1x32x1x4192xi8, strides: [4192, 4192, 4192, 1]>, none)
CHECK-NEXT:        %B194C0 = "system_tr_wr.wr_imm"(%D98C0) {reg_idx0 = 5, reg_idx1 = 6, reg_idx2 = 127, des_imm0 = 0, des_imm1_h32 = 0, des_imm1_l32 = 40960}
CHECK-NEXT:        %R6, %B195C0 = "conv.normal"(%R3.4800, %R5.96, %R5.64, %C0, %R0, %D98C0) {kernel = [1, 1], stride = [1, 1], in_zero = [0, 0], ke_zero = [0, 0], opt_kernel_rotate = False, pad_mode = 0, pad = [0, 0, 0, 0], opt_res_add = False, do_relu = False, sym_range = False, do_rq = True, round_mode = 5, kzp = 0}: (memref<1x512x20x20xsi8, strides: [6400, 400, 20, 1]>, memref<256x512x1x1xsi8>, memref<1x256x1x1xsi32, strides: [8, 1, 1, 1]>, si8, memref<1x256x1x2xsi32, strides: [16, 2, 2, 1]>, none) -> (memref<1x256x20x20xsi8, strides: [3200, 400, 20, 1]>, none)
CHECK-NEXT:        %R7, %D99C0 = "dma.tensor"(%G3928064, %B193C0) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK-NEXT:        %R7, %B196C0 = "tsbc.l_bc"(%R7, %D99C0) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x32x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK:        %R4, %D114C0 = "dma.tensor"(%G5009408, %B239C0) : (memref<1x32x1x1072xi8, strides: [34304, 1072, 1072, 1]>, none) -> (memref<1x32x1x1072xi8, strides: [1072, 1072, 1072, 1]>, none)
CHECK-NEXT:        %B242C0 = "system_tr_wr.wr_imm"(%D114C0) {reg_idx0 = 5, reg_idx1 = 6, reg_idx2 = 127, des_imm0 = 0, des_imm1_h32 = 0, des_imm1_l32 = 32768}
CHECK-NEXT:        %R0, %B243C0 = "conv.normal"(%R2, %R4.48, %R4.32, %C0, %R0, %D114C0) {kernel = [1, 1], stride = [1, 1], in_zero = [0, 0], ke_zero = [0, 0], opt_kernel_rotate = False, pad_mode = 0, pad = [0, 0, 0, 0], opt_res_add = False, do_relu = False, sym_range = False, do_rq = True, round_mode = 5, kzp = 0}: (memref<1x256x40x40xsi8, strides: [12800, 1600, 40, 1]>, memref<128x256x1x1xsi8>, memref<1x128x1x1xsi32, strides: [4, 1, 1, 1]>, si8, memref<1x128x1x2xsi32, strides: [8, 2, 2, 1]>, none) -> (memref<1x128x40x40xsi8, strides: [6400, 1600, 40, 1]>, none)
CHECK-NEXT:        %R1, %D115C0 = "dma.tensor"(%G5046272, %B241C0) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK-NEXT:        %R1, %B244C0 = "tsbc.l_bc"(%R1, %D115C0) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x32x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK-NEXT:        %R4, %B245C0 = "sg.pe_s_gather_d1coor"(%R1, %R1, %D115C0) {limit_enable = False, fill_const = False, const_value = 0}: (memref<1x128x1x256xi8, strides: [0, 0, 271.0, 1]>, memref<1x128x1x1600xui8, strides: [6400, 1600, 1600, 1]>, none) -> (memref<1x128x1x1600xi8, strides: [6400, 1600, 1600, 1]>, none)
CHECK:        %R4.5632, %B289C0 = "sg.pe_s_gather_d1coor"(%R8, %R8, %D131C0) {limit_enable = False, fill_const = False, const_value = 0}: (memref<1x128x1x256xi8, strides: [0, 0, 271.0, 1]>, memref<1x128x1x1600xui8, strides: [6400, 1600, 1600, 1]>, none) -> (memref<1x128x1x1600xi8, strides: [6400, 1600, 1600, 1]>, none)
CHECK-NEXT:        %R7, %D132C0 = "dma.tensor"(%G5402624, %B287C0) : (memref<1x32x1x4656xi8, strides: [148992, 4656, 4656, 1]>, none) -> (memref<1x32x1x4656xi8, strides: [4656, 4656, 4656, 1]>, none)
CHECK-NEXT:        %B290C0 = "system_tr_wr.wr_imm"(%D132C0) {reg_idx0 = 5, reg_idx1 = 6, reg_idx2 = 127, des_imm0 = 0, des_imm1_h32 = 0, des_imm1_l32 = 57344}
CHECK-NEXT:        %R6, %B291C0 = "conv.normal"(%R4.5632, %R7.48, %R7.32, %C0, %R0, %D132C0) {kernel = [3, 3], stride = [1, 1], in_zero = [0, 0], ke_zero = [0, 0], opt_kernel_rotate = False, pad_mode = 0, pad = [1, 1, 1, 1], opt_res_add = False, do_relu = False, sym_range = False, do_rq = True, round_mode = 5, kzp = 0}: (memref<1x128x40x40xsi8, strides: [6400, 1600, 40, 1]>, memref<128x128x3x3xsi8>, memref<1x128x1x1xsi32, strides: [4, 1, 1, 1]>, si8, memref<1x128x1x2xsi32, strides: [8, 2, 2, 1]>, none) -> (memref<1x128x40x40xsi8, strides: [6400, 1600, 40, 1]>, none)
CHECK-NEXT:        %R8, %D133C0 = "dma.tensor"(%G5554176, %B289C0) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK-NEXT:        %R8, %B292C0 = "tsbc.l_bc"(%R8, %D133C0) : (memref<1x1x1x256xi8, strides: [256, 256, 256, 1]>, none) -> (memref<1x32x1x256xi8, strides: [256, 256, 256, 1]>, none)
CHECK:        %B334C0 = "system_tr_wr.wr_imm"(%D152C0) {reg_idx0 = 5, reg_idx1 = 6, reg_idx2 = 127, des_imm0 = 0, des_imm1_h32 = 0, des_imm1_l32 = 108896}
CHECK-NEXT:        %R0, %B335C0 = "conv.normal"(%R3.1024, %R13.2496, %R13.2464, %C0, %R0, %D152C0) {kernel = [1, 1], stride = [1, 1], in_zero = [0, 0], ke_zero = [0, 0], opt_kernel_rotate = False, pad_mode = 0, pad = [0, 0, 0, 0], opt_res_add = False, do_relu = False, sym_range = False, do_rq = True, round_mode = 5, kzp = 0}: (memref<1x256x40x40xsi8, strides: [12800, 1600, 40, 1]>, memref<255x256x1x1xsi8>, memref<1x255x1x1xsi32, strides: [8, 1, 1, 1]>, si8, memref<1x255x1x2xsi32, strides: [16, 2, 2, 1]>, none) -> (memref<1x255x40x40xsi8, strides: [12800, 1600, 40, 1]>, none)
CHECK-NEXT:        %G3379200, %D153C0 = "dma.tensor"(%R5.3840, %B333C0) : (memref<1x255x80x80xi8, strides: [51200, 6400, 80, 1]>, none) -> (memref<1x255x80x80xi8, strides: [1632000, 6400, 80, 1]>, none)
CHECK-NEXT:        %B336C0 = "system_tr_wr.wr_imm"(%D153C0) {reg_idx0 = 5, reg_idx1 = 6, reg_idx2 = 127, des_imm0 = 0, des_imm1_h32 = 0, des_imm1_l32 = 104704}
CHECK-NEXT:        %R2, %B337C0 = "conv.normal"(%R4.5632, %R12.6496, %R12.6464, %C0, %R0, %D153C0) {kernel = [1, 1], stride = [1, 1], in_zero = [0, 0], ke_zero = [0, 0], opt_kernel_rotate = False, pad_mode = 0, pad = [0, 0, 0, 0], opt_res_add = False, do_relu = False, sym_range = False, do_rq = True, round_mode = 5, kzp = 0}: (memref<1x512x20x20xsi8, strides: [6400, 400, 20, 1]>, memref<255x512x1x1xsi8>, memref<1x255x1x1xsi32, strides: [8, 1, 1, 1]>, si8, memref<1x255x1x2xsi32, strides: [16, 2, 2, 1]>, none) -> (memref<1x255x20x20xsi8, strides: [3200, 400, 20, 1]>, none)
CHECK-NEXT:        %G2969600, %D154C0 = "dma.tensor"(%R0, %B335C0) : (memref<1x255x40x40xi8, strides: [12800, 1600, 40, 1]>, none) -> (memref<1x255x40x40xi8, strides: [408000, 1600, 40, 1]>, none)
